/*
 * jsCalendar extension
 * DatePicker v1.0.1
 *
 *
 * MIT License
 *
 * Copyright (c) 2019 Grammatopoulos Athanasios-Vasileios
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */

(function(e){if(!e)throw"Error jsCalendar library was not found";var f={options:{format:"DD/MM/YYYY",offsetTop:2,offsetLeft:-4,close_keycodes:[9,27,13],"class":"jsCalendar-datepicker-wrappper"}},d=function(){0!==arguments.length&&this._construct(arguments)};d.version="v1.0.1-beta";d.prototype._construct=function(a){a=this._parseArguments(a);this._setTarget(a.target);a=this._parseOptions(a.options);this._visible=!1;this._wrapper=document.createElement("div");this._wrapper.className=this._options["class"];
this._wrapper.style.display="none";this._wrapper.style.position="absolute";document.body.appendChild(this._wrapper);a.target=this._wrapper;this.jsCalendar=new e(a);a.hasOwnProperty("date")&&(this._target.value=e.tools.dateToString(e.tools.parseDate(a.date),this._options.format,this.jsCalendar._options.language));var b=this;this.jsCalendar.onDateClick(function(a,d){b._onPick(d)});this._target.addEventListener("focus",function(){b._onFocus()},!1);this._target.addEventListener("keydown",function(a){0<=
b._options.close_keycodes.indexOf(a.keyCode)&&b.hide()},!1);this.jsCalendar._elements.table.addEventListener("click",function(a){a.stopPropagation()},!1);window.addEventListener("click",function(a){a.target!==b._target&&b.hide()},!1);window.addEventListener("resize",function(){b._visible&&b.position()},!1)};d.prototype._parseArguments=function(a){var b={target:null,options:{}};if(0===a.length)throw Error("jsCalendar-datepicker: No parameters were given.");if(1===a.length)if(("object"===typeof HTMLElement?
a[0]instanceof HTMLElement:a[0])&&"object"===typeof a[0]&&null!==a[0]&&1===a[0].nodeType&&"string"===typeof a[0].nodeName||"string"===typeof a[0])b.target=a[0];else if(b.options=a[0],"undefined"!==typeof a[0].target)b.target=a[0].target;else throw Error("jsCalendar-datepicker: Not target was given.");else b.target=a[0],3<=a.length&&(b.options=a[2]),2<=a.length&&(b.options.date=a[1]);return b};d.prototype._setTarget=function(a){if(a=e.tools.getElement(a))this._target=a;else throw Error("jsCalendar-datepicker: Target was not found.");
};d.prototype._parseOptions=function(a){this._options={};var b={};for(c in f.options)f.options.hasOwnProperty(c)&&(this._options[c]=f.options[c]instanceof Array?f.options[c].slice(0):f.options[c]),a.hasOwnProperty(c)?b[c]=a[c]:this._target.dataset.hasOwnProperty(c)&&(b[c]=this._target.dataset[c]);"undefined"!==typeof b.format&&(this._options.format=b.format);if("undefined"!==typeof b.offsetTop)if("number"===typeof b.offsetTop){var c=b.offsetTop;isNaN(c)||(this._options.offsetTop=c)}else"string"===
typeof b.offsetTop&&(c=parseInt(b.offsetTop,10),isNaN(c)||(this._options.offsetTop=c));"undefined"!==typeof b.offsetLeft&&("number"===typeof b.offsetLeft?(c=b.offsetLeft,isNaN(c)||(this._options.offsetLeft=c)):"string"===typeof b.offsetLeft&&(c=parseInt(b.offsetLeft,10),isNaN(c)||(this._options.offsetLeft=c)));"string"===typeof b["class"]&&(this._options["class"]=b["class"]);b={};for(c in e.options)a.hasOwnProperty(c)?b[c]=a[c]:this._target.dataset.hasOwnProperty(c)&&(b[c]=this._target.dataset[c]);
a.hasOwnProperty("date")?b.date=a.date:b.hasOwnProperty("date")||(0<this._target.value.length&&null!==e.tools.parseDate(this._target.value,!0)?b.date=this._target.value:this._target.dataset.hasOwnProperty("date")&&(b.date=this._target.dataset.date));return b};d.prototype._onFocus=function(){this.jsCalendar.reset();this.show()};d.prototype._onPick=function(a){this.jsCalendar._options.min&&this.jsCalendar._options.min.getTime()>a||this.jsCalendar._options.max&&this.jsCalendar._options.max.getTime()<
a||(this._target.value=e.tools.dateToString(a,this._options.format,this.jsCalendar._options.language),this.jsCalendar.set(a),this.hide())};d.prototype.show=function(){this._visible||(this.position(),this._wrapper.style.display="block",this._visible=!0)};d.prototype.hide=function(){this._wrapper.style.display="none";this._visible=!1};d.prototype.isVisible=function(){return this._visible};d.prototype.position=function(){var a=this._wrapper.style.display;this._wrapper.style.top="-9999px";this._wrapper.style.left=
"-9999px";this._wrapper.style.display="block";for(var b=0,c=0,d=this._target;d&&!isNaN(d.offsetLeft)&&!isNaN(d.offsetTop);)b+=d.offsetLeft-d.scrollLeft,c+=d.offsetTop-d.scrollTop,d=d.offsetParent;c=c+(this._target.clientHeight||this._target.offsetHeight||this._target.scrollHeight||20)+this._options.offsetTop;b+=this._options.offsetLeft;document.body.offsetWidth<b+this._wrapper.offsetWidth&&(b=document.body.offsetWidth-this._wrapper.offsetWidth-1);this._wrapper.style.display=a;this._wrapper.style.top=
c+"px";this._wrapper.style.left=b+"px"};d.autoFind=function(){for(var a=document.getElementsByTagName("input"),b=[],c=0;c<a.length;c++)"text"===a[c].type&&a[c].dataset.hasOwnProperty("datepicker")&&"true"!==a[c].getAttribute("jsCalendar-datepicker-loaded")&&b.push(a[c]);for(c=0;c<b.length;c++)b[c].setAttribute("jsCalendar-datepicker-loaded","true"),new d(b[c])};e.ext||(e.ext={});e.ext.datepicker=f;e.ext.datepicker.autoFind=d.autoFind;e.datepicker=function(){var a=new d;a._construct(arguments);return a};
window.addEventListener("load",function(){f.autoFind()},!1)})(window.jsCalendar);
